<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allergy Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        body.light-mode {
            background-color: #f8f9fa;
            color: #333;
        }
        body.dark-mode {
            background-color: #333;
            color: #f8f9fa;
        }
        .header {
            background-color: #8E44AD;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 24px;
            position: relative;
        }
        .home-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }
        .question-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
            transition: background-color 0.3s, transform 0.3s;
        }
        .dark-mode .question-container {
            background-color: #444;
        }
        .question {
            font-size: 18px;
            margin-bottom: 20px;
            transition: opacity 0.3s;
        }
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .option-btn {
            flex: 1 0 calc(20% - 10px);
            max-width: calc(20% - 10px);
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #8e44ad;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
        .option-btn:hover {
            background-color: #9B59B6;
            transform: translateY(-2px);
        }
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        #theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        @media (max-width: 768px) {
            .option-btn {
                flex: 1 0 100%;
                max-width: 100%;
            }
        }
        .fade-in {
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .question-enter {
            animation: questionEnter 0.5s forwards;
        }
        @keyframes questionEnter {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .contributors {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }
        .contributors a {
            color: inherit;
            text-decoration: none;
            margin: 0 10px;
        }
        .contributors {
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body class="dark-mode">
    <button id="theme-toggle" class="btn btn-outline-secondary">
        <i class="fas fa-moon"></i>
    </button>
    <div class="header">
        <a href="/back" class="btn btn-light home-btn"><i class="fas fa-home"></i></a>
        Allergy Predictor
    </div>
    <div class="container">
        <div class="question-container">
            <div class="question" id="question-text">
                Do you have itchy eyes?
            </div>
            <div class="options">
                <button class="option-btn" onclick="answerQuestion(1)">Yes</button>
                <button class="option-btn" onclick="answerQuestion(0)">No</button>
            </div>
        </div>
        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="previousQuestion()"><i class="fas fa-arrow-left"></i> Back</button>
            <button class="btn btn-primary" onclick="nextQuestion()">Next <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>
    <script>
        const questions = [
            "Do you have a cough?",
            "Do you have muscle aches?",
            "Do you feel tired?",
            "Do you have a sore throat?",
            "Do you have a runny nose?",
            "Do you have a stuffy nose?",
            "Do you have a fever?",
            "Do you experience nausea?",
            "Do you experience vomiting?",
            "Do you have diarrhea?",
            "Do you experience shortness of breath?",
            "Do you have difficulty breathing?",
            "Have you lost your sense of taste?",
            "Have you lost your sense of smell?",
            "Do you have an itchy nose?",
            "Do you have itchy eyes?",
            "Do you have an itchy mouth?",
            "Do you have an itchy inner ear?",
            "Do you experience sneezing?",
            "Do you have pink eye?"
        ];
    
        let currentQuestionIndex = 0;
        let responses = {}; // Dictionary to store answers
    
        function displayNextQuestion() {
            const questionText = document.getElementById('question-text');
            const optionButtons = document.querySelectorAll('.option-btn');
    
            questionText.classList.remove('question-enter');
            optionButtons.forEach(btn => btn.classList.remove('fade-in'));
    
            setTimeout(() => {
                if (currentQuestionIndex < questions.length) {
                    questionText.textContent = questions[currentQuestionIndex];
                    questionText.classList.add('question-enter');
                    optionButtons.forEach((btn, index) => {
                        setTimeout(() => {
                            btn.classList.add('fade-in');
                        }, index * 100);
                    });
                    currentQuestionIndex++;
                } else {
                    questionText.textContent = "Thank you for answering all the questions. We will now analyze your responses.";
                    optionButtons.forEach(btn => btn.style.display = 'none');
                    document.querySelector('.btn-primary').style.display = 'none';
                    printResponses(); // Call to print responses
                    sendResponses(); // Send responses to backend
                }
            }, 300);
        }
    
        function answerQuestion(answer) {
            const currentQuestion = questions[currentQuestionIndex - 1]; // Get the current question
            responses[currentQuestion] = answer; // Store the answer in the dictionary
            nextQuestion();
        }
    
        function nextQuestion() {
            displayNextQuestion();
        }
    
        function previousQuestion() {
            if (currentQuestionIndex > 1) {
                currentQuestionIndex -= 2;
                displayNextQuestion();
            }
        }
    
        const responseContainer = document.createElement('div');
        responseContainer.className = 'response-container';
        responseContainer.style.marginTop = '20px';
        responseContainer.style.fontSize = '16px';
        responseContainer.style.textAlign = 'center';
        document.querySelector('.container').appendChild(responseContainer);
    
        function printResponses() {
            responseContainer.innerHTML = ""; // Clear previous responses
            const title = document.createElement('h3');
            title.textContent = "Your Responses:";
            responseContainer.appendChild(title);
    
            for (const [question, answer] of Object.entries(responses)) {
                const responseText = document.createElement('p');
                responseText.textContent = `${question} - Answer: ${answer}`;
                responseContainer.appendChild(responseText);
            }
        }
    
        function sendResponses() {
            // Send the responses to the FastAPI backend
            fetch('/allergy_submit_responses', { // Ensure this matches the backend endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ answers: responses }), // Send the responses in the expected format
            })
            .then(response => response.json())
            .then(data => {
                // Display the result from FastAPI
                const resultText = document.createElement('h4');
                resultText.textContent = `Analysis Result: ${data.analysis}`; // Modify as per your backend logic
                responseContainer.appendChild(resultText);
            })
            .catch(error => {
                console.error('Error:', error);
                const errorText = document.createElement('p');
                errorText.textContent = 'An error occurred while submitting your responses.';
                responseContainer.appendChild(errorText);
            });
        }
    
        displayNextQuestion(); // Display the first question
    
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        const icon = themeToggle.querySelector('i');
    
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            body.classList.toggle('light-mode');
            icon.classList.toggle('fa-sun');
            icon.classList.toggle('fa-moon');
        });
    </script>
    
</body>
</html>
